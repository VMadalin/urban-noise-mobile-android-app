# Android
# Build your Android project with Gradle.
# Add steps that test, sign, and distribute the APK, save build artifacts, and more:
# https://docs.microsoft.com/azure/devops/pipelines/languages/android

name: Scheduled

schedules:
  - cron: "0 12 * * 0"
    displayName: Weekly Scheduled Tasks
    branches:
      include:
        - master
    always: true

pool:
  vmImage: 'macos-latest'

steps:

  # DependencyUpdates
  - task: Gradle@2
    displayName: DependencyUpdates
    inputs:
      workingDirectory: ''
      gradleWrapperFile: 'gradlew'
      gradleOptions: '-Xmx3072m'
      publishJUnitResults: false
      testResultsFiles: '**/TEST-*.xml'
      tasks: 'dependencyUpdates'

  # Publish DependencyUpdates
  - task: PublishPipelineArtifact@1
    displayName: Publish DependencyUpdates
    inputs:
      targetPath: '$(System.DefaultWorkingDirectory)/build/dependencyUpdates'
      publishLocation: 'pipeline'

  # Notify DependencyUpdates
  - task: SlackNotification@5
    displayName: Notify DependencyUpdates
    inputs:
      SlackApiToken: '$(SLACK_TOKEN)'
      MessageAuthor: 'Dependency Bot'
      Channel: 'urban-noise-mobile-android-app'
      IconUrl: 'https://avatars1.githubusercontent.com/u/27347476'
      NotificationType: 'UploadFile'
      UploadFilePath: '$(System.DefaultWorkingDirectory)/build/dependencyUpdates/report.txt'
      FileComment: 'Project dependency updates report'


  - task: SlackNotification@5
    inputs:
      SlackApiToken: '$(SLACK_TOKEN)'
      MessageAuthor: 'Azure DevOps'
      Channel: 'urban-noise-mobile-android-app'
      IconUrl: 'https://avatars1.githubusercontent.com/u/27347476'
      NotificationType: 'ChatMessage'
      Message: 'testttt'

  - task: SlackPoster@2
    inputs:
      UserName: 'Test'
      Message: 'Dependency Bot'
      ApiToken: '$(SLACK_TOKEN)'
      Channel: 'urban-noise-mobile-android-app'
      IconUrl: 'https://avatars1.githubusercontent.com/u/27347476'
      NeverFails: false

